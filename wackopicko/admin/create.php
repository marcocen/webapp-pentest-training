<?php

require_once("../include/admins.php");
require_once("../include/html_functions.php");
require_once("../include/functions.php");

session_start();

$error = False;
if (isset($_POST['username']) && isset($_POST['password']) && isset($_POST['againpass'])
    && $_POST['username'] && $_POST['password'] && $_POST['againpass'])
{
   if ($_POST['password'] != $_POST['againpass'])
   {
      $flash['error'] = "The passwords do not match. Try again";
      $error = True;
   }
   else if ($new_id = Admins::create_admin($_POST['username'], $_POST['password']))
   {
   	  echo "Admin created! <a href=" .Admins::$HOME_URL.">Click here to go to the admin home page</a>";
      Admins::login_user($new_id);
      //http_redirect(Admins::$HOME_URL);
   }
   else
   {
      if (mysql_errno() == 1062)
      {
	 $flash['error'] = "Username '{$_POST['username']}' is already in use.";
      }
      $error = True;
   }
}
else
{
   $flash['error'] = "All fields are required";
   $error = True;
}

if ($error)
{

   ?>
<div class="column prepend-1 span-24 first last" >
<h2> Register a new admin user!</h2>
<?php error_message() ?>
<table cellspacing="0" style="width:320px">
  <form method="POST">
  <tr><td>Username :</td><td> <input type="text" name="username" /></td></tr>
  <tr><td>Password :</td><td> <input type="password" name="password" /></td></tr>
  <tr><td>Password again :</td><td> <input type="password" name="againpass" /></td></tr>
  <tr><td><input type="submit" value="Create Account!" /></td><td></td></tr>
</form>
</table>
</div>



<?php 
}
?>